# Deploying DApps with Truffle
- Truffle

íŠ¸ëŸ¬í”Œ : ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ë¸”ë¡ì²´ì¸ ê°œë°œ í”„ë ˆì„ì›Œí¬

- Truffleì˜ íŠ¹ì§•
    - ì‰¬ìš´ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ compliation
    - ABI ìë™ ìƒì„±
    - í†µí•©ëœ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ í…ŒìŠ¤íŒ… (Mochaì™€ Chai ì§€ì›)
    - multiple networks ì§€ì›
    
- Getting Started with Truffle
    
    truffleâ€™s Default Directory Structure
    
    ```powershell
    $ truffle init
    ```
    
    - contracts : í¬ë¦½í†  ì¢€ë¹„ ë””ë ‰í† ë¦¬ì˜ ë‚´ë¶€ì—ì„œ truffle initì„ running í•˜ëŠ” ê²ƒì€ contracts/tokens ê³¼ ê°™ì€ ëª‡ê°œì˜ ë””ë ‰í† ë¦¬ì™€ ì¼ë¶€ ìë°”ìŠ¤í¬ë¦½íŠ¸, ì†”ë¦¬ë””í‹° íŒŒì¼ì„ ìƒì„±í•´ì•¼í•œë‹¤.
    
    <aside>
    ğŸ’¡ truffle initì€ ìë™ì ìœ¼ë¡œ Migration.solë¼ ë¶ˆë¦¬ëŠ” migration fileê³¼ ì¼ì¹˜í•˜ëŠ” contractë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•´ì¤€ë‹¤.
    
    </aside>
    
    - migrations : migrationì€ truffleì—ê²Œ ìŠ¤ë§ˆíŠ¸ì»¨íŠ¸ë™íŠ¸ë¥¼ ì–´ë–»ê²Œ deployí•˜ëŠ” ì§€ ì„¤ëª…í•˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼
    - test : ìë°”ìŠ¤í¬ë¦½íŠ¸ ë˜ëŠ” ì†”ë¦¬ë””í‹° íŒŒì¼ì˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸. ì»¨íŠ¸ë™íŠ¸ê°€ ì¼ë‹¨ í•œë²ˆ ë°°í¬ ë˜ê³  ë‚˜ë©´ ìˆ˜ì •ë  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ë°°í¬ ì „ì— ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸ í•˜ëŠ”ê²ƒì€ ì•„ì£¼ ì¤‘ìš”í•¨
    - truffle.js and truffle-config.js : configíŒŒì¼ì€ ë°°í¬ë¥¼ ìœ„í•œ ë„¤íŠ¸ì›Œí¬ ì„¤ì •ë“¤ì„ ê¸°ë¡. ê°™ì€ í´ë”ì•ˆì— truffle.js ì™€ truffle.exeë¥¼ ëª¨ë‘ ê°€ì§€ê³  ìˆëŠ” windows ê¸°ë°˜ì—ëŠ” ì¶©ëŒì´ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— truffleì€ ë‘ê°œì˜ config filesì´ í•„ìš”í•¨
        
         â‡’ ìœˆë„ìš° ê¸°ë°˜ì—ì„œ ì‹¤í–‰í•œë‹¤ë©´, truffle.jsë¥¼ ì§€ìš°ê³  truffle-config.jsë¥¼ default config fileë¡œ ì‚¬ìš©í•  ê²ƒì„ ê¶Œì¥.
        

** ì™œ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•´ì•¼í• ê¹Œ? 

1. ë§Œì•½ í´ë”ì˜ ì´ë¦„ì´ ë³€ê²½ëœë‹¤ë©´ ì˜ˆì¸¡í–ˆë˜ëŒ€ë¡œ truffleì´ ì‘ë™í• ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.
2. ê´€ë¡€ì ìœ¼ë¡œ í†µìš©ë˜ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ê°œë°œìë“¤ë„ ì‰½ê²Œ í”„ë¡œì íŠ¸ë¥¼ ì´í•´í•  ìˆ˜ ìˆë‹¤.
3. í‘œì¤€ì ì¸ í´ë” êµ¬ì¡°ì™€ ì½”ë“œ ê´€ë¡€ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²ƒì€ ì¶”í›„ íŒ€ì˜ í™•ì¥ì´ë‚˜ ë³€ê²½ì„ ë³´ë‹¤ ì‰½ê²Œ ë§Œë“ ë‹¤.

- Truffle-hdwallet-provider

ì´ë”ë¦¬ì›€ì— ì½”ë“œë¥¼ ë°°í¬í•˜ê¸° ìœ„í•´ì„œëŠ” Infuraë¥¼ ì‚¬ìš©(í¬ë¦½í† ì¢€ë¹„ì—ì„œ) ì´ ë°©ë²•ì„ í†µí•´, ìì²´ì ì¸ ì´ë”ë¦¬ì›€ ë…¸ë“œ ë˜ëŠ” ì§€ê°‘ì„ ë§Œë“¤ í•„ìš” ì—†ì´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ë³´ì•ˆì„ ìœ ì§€í•˜ê¸° ìœ„í•´ InfuraëŠ” private keysë¥¼ ê´€ë¦¬í•˜ì§€ ì•Šìœ¼ë©°, ì´ê²ƒì€ íŠ¸ëœì­ì…˜ì— ì„œëª…í•  ìˆ˜ ì—†ìŒì„ ì˜ë¯¸í•œë‹¤.

ìŠ¤ë§ˆíŠ¸ì»¨íŠ¸ë™íŠ¸ë¥¼ ë°°í¬í•˜ëŠ” ê²ƒì€ íŠ¸ëœì­ì…˜ì— ì„œëª…í•˜ê¸° ìœ„í•´ truffleì„ ìš”êµ¬í•˜ê¸° ë•Œë¬¸ì— ìš°ë¦¬ëŠ” truffle-hdwallet-providerë¼ëŠ” ë„êµ¬ë¥¼ í•„ìš”ë¡œ í•˜ê²Œ ëœë‹¤. ì´ê²ƒì˜ ìœ ì¼í•œ ëª©ì ì€ íŠ¸ëœì­ì…˜ì— ì„œëª…í•˜ëŠ” ê²ƒì„ í•¸ë“¤ë§í•˜ê¸° ìœ„í•¨ì´ë‹¤.

```powershell
npm install truffle truffle-hdwallet-provider
```

â‡’ truffle init ëª…ë ¹ì–´ëŠ” ë¹ˆ ë””ë ‰í† ë¦¬ë¥¼ ì°¾ëŠ”ë‹¤. ë§Œì•½ ë¹ˆë””í…í† ë¦¬ê°€ ì•„ë‹ˆë¼ë©´ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.

ë”°ë¼ì„œ ì •í™•í•œ ìˆœì„œì— ë”°ë¼ install í•´ì•¼í•œë‹¤. 

1. truffle init
2. npm install truffle-hdwallet-provider

- Compiling the Source Code

Q. ì™œ compile í•˜ëŠ”ê²ƒì´ í•„ìš”í• ê¹Œ?

Ethereum Virtual Machineì€ ìš°ë¦¬ê°€ ì‘ì„±í•œ solidity ì†ŒìŠ¤ ì½”ë“œë¥¼ ë°”ë¡œ ì´í•´í•  ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ ìš°ë¦¬ëŠ” ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ ê¸°ê³„ê°€ ì½ì„ ìˆ˜ ìˆëŠ” bytecodeë¡œ ë²ˆì—­í•´ì£¼ëŠ” compilerë¥¼ ì‹¤í–‰ì‹œì¼œì•¼ í•œë‹¤.

The virtual machineì€ bytecodeë¥¼ ì‹¤í–‰í•˜ê³  ìŠ¤ë§ˆíŠ¸ì»¨íŠ¸ë™íŠ¸ì—ì„œ ìš”êµ¬í•˜ëŠ” actionì„ ì™„ë£Œí•œë‹¤.

- Using the Solidity Compiler

â†’ SafeMathì˜ function ì¤‘ add í•¨ìˆ˜ì˜ ì •ì˜ë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤ê³  ê°€ì •í•˜ì

```solidity
function add(uint16 a, uint16 b) internal returns (uint16) {
	uint16 c = a + b;
	assert (c >= a);
	return c;
}
```

ì´ í•¨ìˆ˜ë¥¼ ì»´íŒŒì¼ í•´ì•¼í•œë‹¤ë©´, ì†”ë¦¬ë””í‹° ì»´íŒŒì¼ëŸ¬ëŠ” warningì„ ë˜ì§ˆê²ƒì´ë‹¤.

```solidity
safemath.sol:110:11 warning: Function state mutability can be restricted to pure
					function add(uint16 a, uint16 b) internal returns (uint16) {
					^ (Relevant source part starts here and spans across multiple lines).
```

ì»´íŒŒì¼ëŸ¬ê°€ ë§í•˜ê³ ì í•˜ëŠ”ê²ƒì€ ìš°ë¦¬ì˜ í•¨ìˆ˜ê°€ ë¸”ë¡ì²´ì¸ì— ì“°ê±°ë‚˜ ë¸”ë¡ì²´ì¸ìœ¼ë¡œë¶€í„° ì½ì„ ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì´ë‹¤. ë˜í•œ ìš°ë¦¬ëŠ” pure ì œì–´ìë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.

Q. ì´ê²ƒì´ ì™œ ì¤‘ìš”í• ê¹Œ ?

pureì™€ view  í•¨ìˆ˜ë¥¼ ë§Œë“œëŠ” ê²ƒì€ gasë¥¼ ì ˆì•½í•œë‹¤. ì´ëŸ¬í•œ í•¨ìˆ˜ëŠ” ë¸”ë¡ì²´ì¸ì˜ ìƒíƒœë¥¼ ë³€ê²½í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ê·¸ê²ƒë“¤ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì±„êµ´ìë“¤ì˜ ë„ì›€ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤. ë‹¨ì§€ ëª‡ ë‹¨ì–´ë¥¼ ì¶”ê°€ í•˜ëŠ” ê²ƒìœ¼ë¡œ pureí•¨ìˆ˜ì™€ view í•¨ìˆ˜ëŠ” ë¬´ë£Œë¡œ call ë  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

```powershell
$truffle compile
```

1. ì´ ëª…ë ¹ì–´ëŠ” build artifactsë¥¼ ë§Œë“¤ê³  ê·¸ê²ƒë“¤ì„ ./build/contracts ë””ë ‰í† ë¦¬ ì•ˆì— ë†“ì„ ê²ƒì´ë‹¤.
    
    â‡’ build artifactsëŠ” ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸, ABIs ê·¸ë¦¬ê³  ì½”ë“œë¥¼ ì •í™•íˆ ë°°í¬í•˜ê¸°ìœ„í•´ íŠ¸ëŸ¬í”Œì´ ì‚¬ìš©í•˜ëŠ” internal dataì˜ bytecode ë²„ì „ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.
    
    â‡’ ì´ íŒŒì¼ë“¤ì„ ê°€ê¸‰ì  ìˆ˜ì •í•˜ì§€ ë§ê³ , íŠ¸ëŸ¬í”Œì„ ì‘ë™ì„ ì ì ˆí•˜ê²Œ êº¼ì•¼í•œë‹¤.
    
- Migrations

Ethereumì„ ë°°í¬í•˜ê¸° ì „ì— ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ í•´ì•¼í•œë‹¤. ì´ê²ƒì„ Ganacheë¥¼ í†µí•´ í• ìˆ˜ ìˆìœ¼ë©° ì´ê²ƒì€ ë¡œì»¬ ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ ì œê³µí•œë‹¤.

ì´ë”ë¦¬ì›€ì„ ë°°í¬í•˜ê¸° ìœ„í•´ì„œ migrationì„ ë¨¼ì € í•´ì•¼í•œë‹¤.

Migrationì€ truffleì´ ì´ë”ë¦¬ì›€ì— ì½”ë“œë¥¼ ë°°í¬í•˜ëŠ” ê²ƒì„ ë•ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì´ë‹¤.

truffle initì€ ë„ˆì˜ ì½”ë“œì— ë„ˆê°€ ë§Œë“œëŠ” ë³€í™”ë¥¼ ê°ì§€í•˜ê¸° ìœ„í•´ Migration.solì„ ë§Œë“ ë‹¤. ì´ê²ƒì´ ì‘ë™í•˜ëŠ” ë°©ì‹ì€ ë³€í™”ì˜ ì´ë ¥ì„ ì²´ì¸ìƒì— ì €ì¥í•˜ëŠ”ê²ƒì´ë‹¤. ë”°ë¼ì„œ ë„ˆëŠ” ê°™ì€ ì½”ë“œë¥¼ ë‘ë²ˆ ë°°í¬í•˜ëŠ” ê²ƒì„ ë§‰ì„ ìˆ˜ ìˆë‹¤. 

- Creating a New Migration

truffle initì„ í†µí•´ ì´ë¯¸ ./contracts/1_initial_migration.jsë¥¼ ìƒì„±í–ˆë‹¤. ê·¸ ë‚´ë¶€ë¥¼ ë“¤ì—¬ë³´ì

```solidity
var Migrations = artifacts.require("./Migrations.sol");
module.exports = function(deployer) {
	deployer.deploy(Migrations);
};
```

1. ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” truffleì—ê²Œ ìš°ë¦¬ê°€ Migrations contractì™€ í†µì‹ í•˜ê¸¸ ì›í•œë‹¤ê³  ì§ê´€ì ìœ¼ë¡œ ë§í•œë‹¤.
2. íŒŒë¼ë¯¸í„°ë¡œ deployerë¼ê³  ë¶ˆë¦¬ëŠ” ê°ì²´ë¥¼ ë°›ëŠ” í•¨ìˆ˜ë¥¼ exportí•œë‹¤.
3. ì´ ê°ì²´ëŠ” ë„ˆ(ê°œë°œì)ì™€ Truffleâ€™s deployment engine ì‚¬ì´ì˜ ì¸í„°í˜ì´ìŠ¤ë¡œì„œ ì—­í• ì„ í•œë‹¤.
4. deployerê°€ ìœ ìš©í•œ í•¨ìˆ˜ë“¤ì„ ë¬´ìˆ˜íˆ ë§ì´ ì œê³µí•˜ë”ë¼ë„, ìš°ë¦¬ëŠ” ì´ ì‹¤ìŠµì— ë²”ìœ„ì—ì„œ ê·¸ë“¤ì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ê²ƒì´ë‹¤.

ë°°í¬ë¥¼ ìœ„í•œ ëª¨ë“  ì¤€ë¹„ë¥¼ ëë‚´ê¸°ì— ì•ì„œ ìš°ë¦¬ëŠ” ./contracts/2_crypto_zombies.jsë¥¼ ìƒˆë¡œ ë§Œë“¤ê³  

./contracts/1_initial_migration.jsì˜ ë‚´ìš©ì„ ë³µì‚¬ ë¶™ì—¬ë„£ê¸° í•œë‹¤.

- Configuration Files

** Ethereum Test Networks

ëª‡ëª‡ì˜ public Ethereum test networksëŠ” ë„ˆê°€ ë„ˆì˜ ì»¨íŠ¸ë™íŠ¸ë¥¼ ë©”ì¸ë„·ì— ë°°í¬í•˜ê¸° ì „ì— ë¬´ë£Œë¡œ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ì´ë„ë¡ í•œë‹¤. (í•œë²ˆ ë°°í¬ëœ ì»¨íŠ¸ë™íŠ¸ëŠ” ìˆ˜ì •ë  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—)  ì´ëŸ¬í•œ í…ŒìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ëŠ” ë©”ì¸ë„·ì˜ í•©ì˜ ì•Œê³ ë¦¬ì¦˜ (ì£¼ë¡œ PoA)ì™€ëŠ” ë‹¤ë¥¸ í•©ì˜ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•œë‹¤. ê·¸ë¦¬ê³  ì² ì €í•œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ EtherëŠ” ë¬´ë£Œì´ë‹¤.

```solidity
$ cat truffle.js
/*
 * NB: since truffle-hdwallet-provider 0.0.5 you must wrap HDWallet providers in a
 * function when declaring them. Failure to do so will cause commands to hang. ex:
 *
 * mainnet: {
 *     provider: function() {
 *       return new HDWalletProvider(mnemonic, 'https://mainnet.infura.io/<infura-key>')
 *     },
 *     network_id: '1',
 *     gas: 4500000,
 *     gasPrice: 10000000000,
 *   },
 */
```

â‡’ ì´ê²ƒì€ ë¹„ì–´ìˆëŠ” shellì´ë‹¤. ë”°ë¼ì„œ ìš°ë¦¬ëŠ” ì´ë”ë¦¬ì›€ ë©”ì¸ë„·ê³¼ Rinkebyì— ì»¨íŠ¸ë™íŠ¸ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•´ ì´ íŒŒì¼ì„ ìˆ˜ì •í•´ì•¼ í• ê²ƒì´ë‹¤.

â‡’ ìˆ˜ì •ì„ ìœ„í•´ì„œ ì•ì„œ installí•œ truffle-hdwallet-providerë¥¼ ì‚¬ìš©í•œë‹¤ (íŠ¸ëœì­ì…˜ì˜ ì„œëª…ì„ ë•ê¸° ìœ„í•´ ì‚¬ìš©)

ì´ê²ƒì„ ì‘ë™í•˜ê¸° ìœ„í•´ íŒŒì¼ì— ì²« ë¶€ë¶„ì— ì½”ë“œ í•œì¤„ì„ ì¶”ê°€í•´ë¼

```solidity
var HDWalletProvider = require("truffle-hdwallet-provider");
```

ê·¸ë¦¬ê³  ìš°ë¦¬ì˜ mnemonicì„ ì €ì¥í•˜ê¸° ìœ„í•œ ë³€ìˆ˜ë¥¼ ë§Œë“ ë‹¤.

```solidity
var mnemonic = "onions carrots beans ...";
```

** configuration fileì— mnemonic ë˜ëŠ” private keyì™€ ê°™ì€ ë¹„ë°€í‚¤ë¥¼ ì €ì¥í•˜ì§€ ì•Šì„ ê²ƒì„ ê¶Œì¥í•œë‹¤.

Q. ì™œ ê¶Œì¥í•˜ì§€ ì•Šì„ê¹Œ?

config filesë“¤ì€ ì¢…ì¢… Githubì— ê°™ì´ push ë˜ì–´ì§„ë‹¤. ë”°ë¼ì„œ ëˆ„êµ¬ë“ ì§€ ê·¸ê²ƒì„ ë³¼ ìˆ˜ ìˆê³  ì´ë¥¼ í†µí•´ ê³µê²©í•  ìˆ˜ìˆë‹¤. ì´ëŸ¬í•œ ê²ƒì„ í”¼í•˜ê¸° ìœ„í•´ ë„ˆëŠ” ê·¸ê²ƒì„ íŒŒì¼ë¡œë¶€í„° ì½ì–´ ì˜¤ê³  ê·¸ íŒŒì¼ì„  .gitignoreì— ì¶”ê°€í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. 

- Set up Truffle for Rinkeby and Ethereum main net

ë‹¤ìŒìœ¼ë¡œ, truffleì´ ìš°ë¦¬ê°€ ë°°í¬í•˜ê¸° ì›í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ ì•Œê²Œ í•˜ê¸°ìœ„í•´ì„œ ë‘ê°œì˜ ë¶„ë¦¬ëœ ê°ì²´ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤ ( for Rinkeby / for Ethererum main net)

```solidity
networks: {
  // Configuration for mainnet
  mainnet: {
    provider: function () {
      // Setting the provider with the Infura Mainnet address and Token
      return new HDWalletProvider(mnemonic, "https://mainnet.infura.io/v3/YOUR_TOKEN")
    },
    network_id: "1"
  },
  // Configuration for rinkeby network
  rinkeby: {
    // Special function to setup the provider
    provider: function () {
      // Setting the provider with the Infura Rinkeby address and Token
      return new HDWalletProvider(mnemonic, "https://rinkeby.infura.io/v3/YOUR_TOKEN")
    },
    // Network id is 4 for Rinkeby
    network_id: 4
  }
```

â‡’ provider valueëŠ” í•¨ìˆ˜ë¡œ ê°ì‹¸ì§€ê³ , ì´ê²ƒì€ ê·¸ê²ƒì´ í•„ìš”ë¡œ ë˜ì–´ì§ˆë•Œ ê¹Œì§€ ì´ˆê¸°í™” ë˜ì§€ ì•ŠëŠ” ë‹¤ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤.

- Wrapping it up

```solidity
// Initialize HDWalletProvider
const HDWalletProvider = require("truffle-hdwallet-provider");

// Set your own mnemonic here
const mnemonic = "YOUR_MNEMONIC";

// Module exports to make this configuration available to Truffle itself
module.exports = {
  // Object with configuration for each network
  networks: {
    // Configuration for mainnet
    mainnet: {
      provider: function () {
        // Setting the provider with the Infura Mainnet address and Token
        return new HDWalletProvider(mnemonic, "https://mainnet.infura.io/v3/YOUR_TOKEN")
      },
      network_id: "1"
    },
    // Configuration for rinkeby network
    rinkeby: {
      // Special function to setup the provider
      provider: function () {
        // Setting the provider with the Infura Rinkeby address and Token
        return new HDWalletProvider(mnemonic, "https://rinkeby.infura.io/v3/YOUR_TOKEN")
      },
      // Network id is 4 for Rinkeby
      network_id: 4
    }
  }
};
```

- Deploying Our Smart Contract
    - Migrations
    
    migrationdì€ truffleì—ê²Œ ìŠ¤ë§ˆíŠ¸ì»¨íŠ¸ë™íŠ¸ì˜ ìƒíƒœê°€ ì–´ë–»ê²Œ ìˆ˜ì •ë˜ì—ˆëŠ”ì§€ ì•Œë ¤ì£¼ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì— ë¶ˆê³¼í•˜ë‹¤.
    
    ì •í™•íˆ ë§í•´ì„œ, ì²«ë²ˆì§¸ migrationì€ ìŠ¤ë§ˆíŠ¸ì»¨íŠ¸ë™íŠ¸ë¥¼ ë‹¨ìˆœíˆ ë°°í¬í•˜ëŠ” ê²ƒì´ë‹¤. ê·¸ ë‹¤ìŒ migrationdì€ ë²„ê·¸ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ëª‡ëª‡ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê¸° ìœ„í•œ ì½”ë“œì˜ ìƒˆë¡œìš´ ë²„ì „ì„ ë°°í¬í•˜ëŠ” ê²ƒì´ë‹¤.
    
    ìš”ì•½í•˜ìë©´, migrationì€ ë„ˆì˜ ì½”ë“œì— ë„ˆê°€ ë§Œë“  ë³€í™”ë¥¼ ì¶”ì í•˜ê¸° ìœ„í•œ ê°„í¸í•œ ë°©ë²•ì„ ì œê³µí•˜ëŠ” ê²ƒì´ë‹¤.
    
    ë§Œì•½ ë„ˆê°€ í•˜ë‚˜ ì´ìƒì˜ ì»¨íŠ¸ë™íŠ¸ë¥¼ ë°°í¬í•˜ê¸¸ ì›í•œë‹¤ë©´, ë°˜ë“œì‹œ ê°ê° ì»¨íŠ¸ë™íŠ¸ì— ë§ê²Œ ê°œë³„ì ì¸ migrationíŒŒì¼ì´ í•„ìš”ë¡œ ë˜ì–´ì§„ë‹¤.  ë˜í•œ migrationì€ í•­ìƒ 1,2,3 ë“± ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë˜ì–´ ì§„ë‹¤.
    
- Get some Ether

ë°°í¬ë¥¼ í•˜ê¸° ì „ì—, ê³„ì¢Œì— ì¶©ë¶„í•œ ì–‘ì˜ Etherê°€ ìˆì–´ì•¼ í•œë‹¤. í…ŒìŠ¤íŠ¸ ëª©ì ìœ¼ë¡œ ì´ë”ë¥¼ ì–»ê¸°ìœ„í•œ ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì€ faucetì´ë¼ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì´ë‹¤. ( Autehnticated Faucet ì¶”ì²œ)

- Put it to the test
1. ëª¨ë“ ê²ƒì´ ì„¤ì • ë˜ì—ˆë‹¤ë©´, Rinkebyì— ë°°í¬í•´ë³´ì. ê·¸ë ‡ê²Œ í•˜ê¸° ìœ„í•´ ì•„ë˜ ì½”ë“œë¥¼ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰í•˜ì

```powershell
$truffle migrate --network rinkeby
```

<aside>
ğŸ’¡ truffle migrateëŠ” truffle deployë¼ê³  ë³„ì¹­í•œë‹¤. í•˜ì§€ë§Œ command-line-interpreterëŠ” ìƒë‹¹íˆ ê¸°ì´ˆì ì´ê¸° ë•Œë¬¸ì— migrateë¼ëŠ” ë‹¨ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ì˜¬ë°”ë¥¸ ë‹µìœ¼ë¡œ ì¸ì‹í•˜ì§€ ì•ŠëŠ”ë‹¤.

</aside>

** main netì— ì»¨íŠ¸ë™íŠ¸ë¥¼ ë°°í¬í•˜ëŠ” ê²ƒì€ ì „í˜€ ë³µì¡í•˜ì§€ ì•Šë‹¤.

```powershell
$truffle migrate --network mainnet
```

â‡’ í•˜ì§€ë§Œ ë°°í¬ì‹œ ì‹¤ì œ ê°€ìŠ¤ê°€ ì§€ë¶ˆë˜ë‹ˆ ì£¼ì˜í•´ì•¼í•œë‹¤

- Use Truffle with Loom
    - Loom Basechain
    
    ì´ë”ë¦¬ì›€ ë””ì•±ì„ ë§Œë“¤ë•Œ, ë©”ì¸ë„·ì—ì„œ ìœ ì €ëŠ” ëª¨ë“  íŠ¸ëœì­ì…˜ë§ˆë‹¤ ê°€ìŠ¤ë¹„ë¥¼ ì§€ë¶ˆí•´ì•¼í•œë‹¤. ì´ê²ƒì€ uxë¥¼ ì‰½ê²Œ ì†ìƒì‹œí‚¤ë©° user-facing DApp ë˜ëŠ” gameì— ì í•©í•˜ì§€ ì•Šë‹¤.
    
    Loomì—ì„œëŠ” í›¨ì”¬ ë” ë¹ ë¥´ê³  ê°€ìŠ¤ë¹„ê°€ ë“¤ì§€ ì•ŠëŠ” í™˜ê²½ì„ ì œê³µí•œë‹¤. ì´ê²ƒì€ ê²Œì„ê³¼ ë‹¤ë¥¸ ì•±ì— í›¨ì”¬ ë” ì í•©í•˜ë‹¤.
    
    Loomì— ì»¨íŠ¸ë™íŠ¸ë¥¼ ë°°í¬í•˜ëŠ”ê²ƒì€ rinkebyë‚˜ mainnetì— ì»¨íŠ¸ë™íŠ¸ë¥¼ ë°°í¬í•˜ëŠ” ê²ƒë„ ë‹¤ë¥´ì§€ ì•Šë‹¤.
    
    ```powershell
    $npm install loom-truffle-provider
    ```
    
- Deploy to Loom TestNet

ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ Loom TestNetì— ë°°í¬í•˜ê¸° ì „ì— ì‚¬ì „ì‘ì—…ì´ í•„ìš”í•˜ë‹¤

1. Loom private key ìƒì„±
    
    ```powershell
    $./loom genkey -a public_key -k private_key
    local address: 0x42F401139048AB106c9e25DCae0Cf4b1Df985c39
    local address base64: QvQBE5BIqxBsniXcrgz0sd+YXDk=
    $cat private_key
    /i0Qi8e/E+kVEIJLRPV5HJgn0sQBVi88EQw/Mq4ePFD1JGV1Nm14dA446BsPe3ajte3t/tpj7HaHDL84+Ce4Dg==
    ```
    
2. updating truffle.js
    
    loom-truffle-providerë¥¼ initializeí•˜ê¸° ìœ„í•´ ì½”ë“œ ìˆ˜ì •ì´ í•„ìš”í•¨
    
    truffle.js ë§¨ ìœ—ì¤„ì— ì•„ë˜ ì½”ë“œ ì¶”ê°€
    
    ```solidity
    const LoomTruffleProvider = require('loom-truffle-provider');
    ```
    
    truffleì´ Loom testnetì—ì„œ ë°°í¬í•˜ëŠ” ë°©ë²•ì„ ì•Œ ìˆ˜ ìˆë„ë¡ ìƒˆë¡œìš´ ê°ì²´ë¥¼ truffle.jsì— ì¶”ê°€
    
    ```solidity
    loom_testnet: {
      provider: function() {
        const privateKey = 'YOUR_PRIVATE_KEY'
        const chainId = 'extdev-plasma-us1';
        const writeUrl = 'http://extdev-plasma-us1.dappchains.com:80/rpc';
        const readUrl = 'http://extdev-plasma-us1.dappchains.com:80/query';
        return new LoomTruffleProvider(chainId, writeUrl, readUrl, privateKey);
        },
      network_id: '9545242630824'
    }
    ```
    

- Deploy to Basechain

1. ìƒˆë¡œìš´ private key ìƒì„± ; í‚¤ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ íŒŒì¼ì˜ ì´ë¦„ì„ë°˜ë“œì‹œ ë³€ê²½í•´ì•¼í•¨
    
    ```powershell
    ./loom genkey -a mainnet_public_key -k mainnet_private_key
    local address: 0x07419790A773Cc6a2840f1c092240922B61eC778
    local address base64: B0GXkKdzzGooQPHAkiQJIrYex3g=
    ```
    
2. private key fileì´ Githubì— push ë˜ëŠ”ê²ƒ ë°©ì§€
    
    ```powershell
    touch .gitignore
    ```
    
    ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì €ì¥ëœ private keyê°€ ìˆëŠ” fileì„ ë¬´ì‹œí•˜ë¼ê³  GitHubì— ì•Œë¦¬ëŠ” ëª…ë ¹ì–´
    
    ```powershell
    echo mainnet_private_key >> .gitignore
    ```
    
    ìƒˆë¡œìš´ LoomTruffleProviderë¥¼ initializeí•˜ê³  íŒŒì¼ë¡œë¶€í„° private keyë¥¼ ì½ê¸° ìœ„í•œ í•¨ìˆ˜ë¥¼ ì •ì˜
    
    ```solidity
    function getLoomProviderWithPrivateKey (privateKeyPath, chainId, writeUrl, readUrl) {
      const privateKey = readFileSync(privateKeyPath, 'utf-8');
      return new LoomTruffleProvider(chainId, writeUrl, readUrl, privateKey);
    }
    ```
    
3. Basechainì— ë°°í¬í•˜ëŠ” ë°©ë²•ì„ truffleì— ì•Œë¦¬ê¸°
    
    ```solidity
    basechain: {
      provider: function() {
        const chainId = 'default';
        const writeUrl = 'http://basechain.dappchains.com/rpc';
        const readUrl = 'http://basechain.dappchains.com/query';
        return new LoomTruffleProvider(chainId, writeUrl, readUrl, privateKey);
        const privateKeyPath = path.join(__dirname, 'mainnet_private_key');
        const loomTruffleProvider = getLoomProviderWithPrivateKey(privateKeyPath, chainId, writeUrl, readUrl);
        return loomTruffleProvider;
        },
      network_id: '*'
    }
    ```
    
    truffle.js ì½”ë“œ ìˆ˜ì •í•˜ê¸°
    
    ```solidity
    // Initialize HDWalletProvider
    const HDWalletProvider = require("truffle-hdwallet-provider");
    
    const { readFileSync } = require('fs')
    const path = require('path')
    const { join } = require('path')
    
    // Set your own mnemonic here
    const mnemonic = "YOUR_MNEMONIC";
    
    function getLoomProviderWithPrivateKey (privateKeyPath, chainId, writeUrl, readUrl) {
      const privateKey = readFileSync(privateKeyPath, 'utf-8');
      return new LoomTruffleProvider(chainId, writeUrl, readUrl, privateKey);
    }
    
    // Module exports to make this configuration available to Truffle itself
    module.exports = {
      // Object with configuration for each network
      networks: {
        // Configuration for mainnet
        mainnet: {
          provider: function () {
            // Setting the provider with the Infura Rinkeby address and Token
            return new HDWalletProvider(mnemonic, "https://mainnet.infura.io/v3/YOUR_TOKEN")
          },
          network_id: "1"
        },
        // Configuration for rinkeby network
        rinkeby: {
          // Special function to setup the provider
          provider: function () {
            // Setting the provider with the Infura Rinkeby address and Token
            return new HDWalletProvider(mnemonic, "https://rinkeby.infura.io/v3/YOUR_TOKEN")
          },
          // Network id is 4 for Rinkeby
          network_id: 4
        },
    
        basechain: {
          provider: function() {
            const chainId = 'default';
            const writeUrl = 'http://basechain.dappchains.com/rpc';
            const readUrl = 'http://basechain.dappchains.com/query';
            return new LoomTruffleProvider(chainId, writeUrl, readUrl, privateKey);
            const privateKeyPath = path.join(__dirname, 'mainnet_private_key');
            const loomTruffleProvider = getLoomProviderWithPrivateKey(privateKeyPath, chainId, writeUrl, readUrl);
            return loomTruffleProvider;
            },
          network_id: '*'
        }
      }
    };
    ```
    
4. whitelist your deployment keys
    
    Basechainì— ë°°í¬í•˜ê¸° ì „ì— Mainnet guideë¡œë¶€í„° ë‹¤ìŒì˜ ëª…ë ¹ë“¤ì„ ë”°ë¼ì„œ ë°±ì„œ(whitelist)ë¡œ ë§Œë“¤í•„ìš”ê°€ ìˆë‹¤.