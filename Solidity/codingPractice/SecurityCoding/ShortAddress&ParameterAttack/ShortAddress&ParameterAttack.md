# 짧은 주소/파라미터 공격 (Short Address/Parameter Attack)

- 이 공격은 solidity 계약 자체가 아니라 어플리케이션 간에 거래를 수행됩니다.
- 아무 문제 없는 컨트랙트같은데, 입력값을 통해 컨트랙트를 공격할 수 있습니다.
- 의도적으로 입력 파라미터를 짧게 했을 때의 EVM의 동작방식을 이용하여 공격하는 패턴입니다.

**취약점**

- 컨트랙트에 파라미터는 전송할 수 있는데, 해당 컨트랙트의 ABI 스펙을 따릅니다.
- 그러나, 요구되는 파라미터의 길이보다 짧은 파라미터를 전송할 수 있습니다.
- 즉, 입력값으로 20바이트 데이터를 받는데, 19바이트의 데이터를 보낼 수 있습니다.
- 이 경우, EVM은 모자란 1바이트를 보내진 데이터 제일 뒤에 00(1바이트) 추가합니다.
- 가장 쉬운 예가 ERC-20 토큰 전송시 주소를 체크하지 않는 경우입니다.
- 이것의 문제는 예를 들어, 어떤 주소로 어떤 금액을 보낼 때, 주소를 의도적으로 짧게 하면 뒤의 인자인 **금액 부분이 바뀌게 됩니다.**

**공격 예시**

```solidity
function transfer(address to, uint tokens) public returns (bool success);
```

- 짧은 파라미터 전송
    
    a9059cbb000000000000000000000000deaddeaddea \
    
    ddeaddeaddeaddeaddeaddeaddead0000000000000
    
    000000000000000000000000000000000056bc75e2d63100000
    
- EVM이 부족한 부분을 메꿈 (제일 뒷자리에 00이 추가되어 있음)
    
    a9059cbb000000000000000000000000deaddeaddea \
    
    ddeaddeaddeaddeaddeaddeadde00000000000000
    
    00000000000000000000000000000000056bc75e2d63100000**00**
    
- 전송된 파라미터
    
    > to : a9059cbb000000000000000000000000deaddeadde   
    tokens : 56bc75e2d63100000 (100tokens)
    > 
- 읽힌 파라미터
    
    > to : a9059cbb000000000000000000000000deaddeadde**00**   
    tokens : 56bc75e2d63100000**00** (25600tokens)
    > 

- 만약 거래소에서 해커가 이와 같은 취약점을 이용하면, 거래소 모르게 큰 금액을 빼갈 수 있습니다. 거래소 입장에서는 요청한 금액만 전송되었다고 생각할 것입니다.
- 물론, 해커가 파라미터를 짧게 하여 만들어진 주소를 소유하고 있진 않을 것입니다. (자신이 원하는 주소를 가질 확률은 극히 낮음)
- 그러나 주소가 0s로 끝나는 것을 소유하고 있을 때, 토큰을 해킹할 수 있습니다.
    
    (0으로 끝나면, 해당 부분을 없애서 짧게 주소를 생성하여 파라미터 전달을 하고, 이때 EVM이 부족한 부분을 0으로 채울 것이기 때문에 해커가 소유한 주소로 인식됨)
    

**예방 기법**

- 애플리케이션의 모든 입력값은 블록체인에 보내기 전에 검증되어야 합니다.
- 문제가 짧은 파라미터에 대해서 끝에 0s붙는 것이기 때문에 파라미터 순서를 잘 정의하면 문제를 예방할 수 도 있습니다.
- 스마트컨트랙트에 체크 로직을 추가합니다.

```solidity
contract NonPayloadAttackableToken {
    **modifier onlyPayloadSize(uint size) { 
          assert(msg.data.length >= size + 4);
      _;**    
}
function transfer(address _to, uint256 _value) onlyPayloadSize(2 * 32) {
     // do stuff   
}
}
```